<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Spring MVC + Mybatis + MySQL CRUD Demo</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">


    <link rel="canonical" href="http://yourdomain.com/java/2014/07/04/Spring%20MVC-Mybatis-MySQL-CRUD-Demo.html">

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/pygment_trac.css">
    <script src="/css/scale.fix.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

</head>


  <body>

    <div class="wrapper">
        <!--<header class="site-header">-->

  <!--<div class="wrapper">-->

    <!--<a class="site-title" href="/">Qiuliang's Blog</a>-->

    <!--<nav class="site-nav">-->
      <!--<a href="#" class="menu-icon">-->
        <!--<svg viewBox="0 0 18 15">-->
          <!--<path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>-->
          <!--<path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>-->
          <!--<path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>-->
        <!--</svg>-->
      <!--</a>-->

      <!--<div class="trigger">-->
        <!---->
          <!---->
          <!--<a class="page-link" href="/about/">About</a>-->
          <!---->
        <!---->
          <!---->
        <!---->
          <!---->
        <!---->
      <!--</div>-->
    <!--</nav>-->

  <!--</div>-->

<!--</header>-->

<header>
    <h1><a href="/">Qiuliang's Blog</a></h1>
    <p>powered by github.io</p>
    <p class="view"><a href="https://github.com/qiuliang">View the Project on GitHub <small>qiuliang</small></a></p>
    <ul>
        <li class="single"><a href="https://github.com/qiuliang/qiuliang.github.io">View On <strong>GitHub</strong></a></li>
    </ul>
</header>

        <section>
            <div class="post">

    <h1 class="post-title">Spring MVC + Mybatis + MySQL CRUD Demo</h1>
    <p class="post-meta">Jul 4, 2014</p>

  <article class="post-content">
    <p>本文档结合<code>Spring MVC</code>、<code>Mybatis</code>、<code>MySQL</code>，说明如何实现一个简单的数据库单表CRUD操作。开发工具使用集成了spring mvc的eclipse（Spring Tool Suite，简称STS）。</p>

<p>[TOC]</p>

<h2 id="section">基础环境说明</h2>

<ul>
  <li>Mac OS X <code>10.9.4</code></li>
  <li>jre version <code>1.8.0_05</code></li>
  <li>java sdk <code>1.8.0_05</code></li>
  <li>STS <code>3.5.1</code></li>
  <li>maven <code>3.2.2</code></li>
</ul>

<p>以上环境安装配置好后，就可以开始demo程序了。</p>

<h3 id="mysql">MySQL建表语句</h3>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="k">user</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">age</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">4</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">big5</span></code></pre></div>

<h2 id="step-1-spring-mvc">Step 1 新建spring mvc项目</h2>

<p>使用STS新建一个spring mvc project，建立好项目后，一个基本的spring mvc web项目已经搭建好，我们只需要在这之上配置好相关的beans，以及编写CRUD相关的代码。</p>

<p>可以注意一下项目中的<code>web.xml</code>、<code>servlet-context.xml</code>，STS已经帮我们把跟spring相关的基本配置项配置好。</p>

<p>例如：web.xml中定义了请求由spring接管，以及IOC相关的配置文件名称。</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- Processes application requests --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="c">&lt;!-- IOC配置文件 --&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>/WEB-INF/spring/appServlet/servlet-context.xml<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span></code></pre></div>

<h2 id="step-2-mavenjar">Step 2 使用maven加载所需的jar包</h2>

<p>如果使用独立安装的maven程序，需要在eclipse中指定maven的路径：</p>

<p>Preferences – Maven – Installations</p>

<p>例如，我的路径是：/usr/local/maven/maven3.2.2</p>

<p>maven配置好后，就可以在pom文件中添加相关的依赖项了，需要添加的相关依赖配置如下：</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-context-support<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="c">&lt;!-- mybatis --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.1.31<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>commons-dbcp<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-dbcp<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mybatis-spring<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.2.7<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<blockquote>
  <p>需要注意跟spring相关的jar包的版本问题</p>
</blockquote>

<p>保存pom文件后会自动根据配置文件下载所需的jar包。</p>

<h2 id="step-3-">Step 3 主要配置示例</h2>

<h3 id="bean">bean相关配置</h3>
<p>在servlet-context.xml配置文件中增加如下的bean，注意schema格式</p>

<p>数据源：</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="c">&lt;!--数据源：--&gt;</span>
<span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">class=</span><span class="s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="na">lazy-init=</span><span class="s">&quot;default&quot;</span> <span class="na">autowire=</span><span class="s">&quot;default&quot;</span>  <span class="err">]]</span><span class="nt">&gt;</span>
      <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">&quot;driverClassName&quot;</span> <span class="na">value=</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="err">]]</span><span class="nt">&gt;</span><span class="err">&lt;</span>/beans:property]]&gt;
      <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">&quot;url&quot;</span> <span class="na">value=</span><span class="s">&quot;jdbc:mysql://127.0.0.1:3306/remember&quot;</span> <span class="err">]]</span><span class="nt">&gt;</span><span class="err">&lt;</span>/beans:property]]&gt;
      <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;root&quot;</span><span class="err">]]</span><span class="nt">&gt;</span><span class="err">&lt;</span>/beans:property]]&gt;
      <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;123456&quot;</span><span class="err">]]</span><span class="nt">&gt;</span><span class="err">&lt;</span>/beans:property]]&gt;
      
   <span class="err">&lt;</span>/beans:bean]]&gt;</code></pre></div>

<p>Mybatis Sql Session配置：
&gt; 由spring接管的mybatis session，configLocation配置的value要和实际的mybatis配置文件一致。</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">&quot;sqlSessionFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span><span class="err">]]</span><span class="nt">&gt;</span>
      <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">&quot;configLocation&quot;</span> <span class="na">value=</span><span class="s">&quot;classpath:springdemo-mybatis-config.xml&quot;</span><span class="err">]]</span><span class="nt">&gt;</span><span class="err">&lt;</span>/beans:property]]&gt;
      <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">&quot;dataSource&quot;</span> <span class="na">ref=</span><span class="s">&quot;dataSource&quot;</span> <span class="nt">/&gt;</span>
   <span class="err">&lt;</span>/beans:bean]]&gt; 
 
   <span class="nt">&lt;beans:bean</span> <span class="na">class=</span><span class="s">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span><span class="err">]]</span><span class="nt">&gt;</span>
      <span class="nt">&lt;beans:property</span> <span class="na">name=</span><span class="s">&quot;basePackage&quot;</span> <span class="na">value=</span><span class="s">&quot;ql.mac.springdemo&quot;</span> <span class="nt">/&gt;</span>
   <span class="err">&lt;</span>/beans:bean]]&gt;</code></pre></div>

<h3 id="mybatis">Mybatis主配置文件</h3>

<p>springdemo-mybatis-config.xml配置文件示例如下：</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration</span>
<span class="cp">    PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
<span class="cp">    &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;]]&gt;</span>
 
<span class="nt">&lt;configuration</span><span class="err">]]</span><span class="nt">&gt;</span>
   <span class="nt">&lt;settings</span><span class="err">]]</span><span class="nt">&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;cacheEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;lazyLoadingEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;aggressiveLazyLoading&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span> 
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;multipleResultSetsEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;useColumnLabel&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;useGeneratedKeys&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;autoMappingBehavior&quot;</span> <span class="na">value=</span><span class="s">&quot;PARTIAL&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;defaultExecutorType&quot;</span> <span class="na">value=</span><span class="s">&quot;SIMPLE&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;defaultStatementTimeout&quot;</span> <span class="na">value=</span><span class="s">&quot;25000&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;safeRowBoundsEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;localCacheScope&quot;</span> <span class="na">value=</span><span class="s">&quot;SESSION&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;jdbcTypeForNull&quot;</span> <span class="na">value=</span><span class="s">&quot;OTHER&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&quot;lazyLoadTriggerMethods&quot;</span> <span class="na">value=</span><span class="s">&quot;equals,clone,hashCode,toString&quot;</span> <span class="nt">/&gt;</span>
   <span class="err">&lt;</span>/settings]]&gt;
   <span class="nt">&lt;typeAliases</span><span class="err">]]</span><span class="nt">&gt;</span>
      <span class="nt">&lt;typeAlias</span> <span class="na">alias=</span><span class="s">&quot;User&quot;</span> <span class="na">type=</span><span class="s">&quot;ql.mac.springdemo.model.User&quot;</span> <span class="nt">/&gt;</span>
   <span class="err">&lt;</span>/typeAliases]]&gt;
   <span class="nt">&lt;mappers</span><span class="err">]]</span><span class="nt">&gt;</span>
      <span class="nt">&lt;mapper</span> <span class="na">resource=</span><span class="s">&quot;mapper/user.xml&quot;</span> <span class="nt">/&gt;</span>
   <span class="err">&lt;</span>/mappers]]&gt;
<span class="err">&lt;</span>/configuration]]&gt;</code></pre></div>

<h3 id="mapper">mapper文件</h3>
<p>例如：mapper/user.xml</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;   &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;ql.mac.springdemo.da.UserMapper&quot;</span><span class="nt">&gt;</span> 
       
    
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;get&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;int&quot;</span>  <span class="na">resultType=</span><span class="s">&quot;User&quot;</span><span class="nt">&gt;</span>
      select * from user where ID=#{id};
    <span class="nt">&lt;/select&gt;</span>
     
    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;insert&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;User&quot;</span> <span class="nt">&gt;</span>
      insert into user values (#{id}, #{name}, #{age});
    <span class="nt">&lt;/insert&gt;</span>
    
    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;update&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;User&quot;</span> <span class="nt">&gt;</span>
      update user set name=#{name},age=#{age} where id=#{id};
    <span class="nt">&lt;/update&gt;</span>
  
<span class="nt">&lt;/mapper&gt;</span></code></pre></div>

<h2 id="step-4-">Step 4 主要代码</h2>

<h3 id="model">定义Model</h3>
<p>User.java</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">ql</span><span class="o">.</span><span class="na">mac</span><span class="o">.</span><span class="na">springdemo</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">age</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<h3 id="crud">定义CRUD操作接口</h3>
<p>UserMapper.java</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">ql</span><span class="o">.</span><span class="na">mac</span><span class="o">.</span><span class="na">springdemo</span><span class="o">.</span><span class="na">da</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">ql.mac.springdemo.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserMapper</span> <span class="o">{</span>
	<span class="n">User</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
	<span class="kt">void</span> <span class="nf">insert</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">);</span>
	<span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">);</span>
<span class="o">}</span></code></pre></div>

<h3 id="action">编写Action</h3>

<p>在Controller中增加CRUD相关的action。需要先将数据操作的mapper类注入到controller中，增加代码如下：</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="n">UserMapper</span> <span class="n">_userMapper</span><span class="o">;</span></code></pre></div>

<h4 id="get">get一个数据实体</h4>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/get/{id}&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">User</span> <span class="n">u</span> <span class="o">=</span> <span class="n">_userMapper</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="n">u</span><span class="o">);</span>

    <span class="k">return</span> <span class="s">&quot;user&quot;</span><span class="o">;</span>
<span class="o">}</span></code></pre></div>

<p>注解RequestMapping说明对应的url，以及http method，其中{id}代表URL参数，和action中的参数id对应，同时需要在参数id前增加注解：@PathVariable(“id”)</p>

<p>这里使用spring内置的model传递参数到view，在页面上可以采用如下语句获取数据实体内容。</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div&gt;</span>
	<span class="nt">&lt;p&gt;</span>
		<span class="nt">&lt;strong&gt;</span>Id<span class="nt">&lt;/strong&gt;</span>
		<span class="nt">&lt;span&gt;</span>${user.getId()}<span class="nt">&lt;/span&gt;</span>
	<span class="nt">&lt;/p&gt;</span>
	<span class="nt">&lt;p&gt;</span>
		<span class="nt">&lt;strong&gt;</span>Name<span class="nt">&lt;/strong&gt;</span>
		<span class="nt">&lt;span&gt;</span>${user.getName()}<span class="nt">&lt;/span&gt;</span>
	<span class="nt">&lt;/p&gt;</span>
	<span class="nt">&lt;p&gt;</span>
		<span class="nt">&lt;strong&gt;</span>Age<span class="nt">&lt;/strong&gt;</span>
		<span class="nt">&lt;span&gt;</span>${user.getAge()}<span class="nt">&lt;/span&gt;</span>
	<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></div>

<h4 id="insert">insert一个数据实体</h4>

<p>add的get方法</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/add&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span> <span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">Insert</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">&quot;add&quot;</span><span class="o">;</span>
	<span class="o">}</span></code></pre></div>

<p>add的post方法</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/add&quot;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span> <span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">Insert</span><span class="o">(</span><span class="n">User</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">_userMapper</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&quot;insert a new user&quot;</span><span class="o">;</span>
<span class="o">}</span></code></pre></div>

<p>对应的view</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
	<span class="nt">&lt;div&gt;</span>
		<span class="nt">&lt;p&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">value=</span><span class="s">&quot;${user.getId()}&quot;</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/p&gt;</span>
		<span class="nt">&lt;p&gt;</span>
			<span class="nt">&lt;strong&gt;</span>Name<span class="nt">&lt;/strong&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">value=</span><span class="s">&quot;${user.getName()}&quot;</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/p&gt;</span>
		<span class="nt">&lt;p&gt;</span>
			<span class="nt">&lt;strong&gt;</span>Age<span class="nt">&lt;/strong&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">value=</span><span class="s">&quot;${user.getAge()}&quot;</span> <span class="na">name=</span><span class="s">&quot;age&quot;</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;/p&gt;</span>
	<span class="nt">&lt;/div&gt;</span>
	
	<span class="nt">&lt;div&gt;</span>
		<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit&quot;</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></div>

<p>其他update和delete操作和上面基本类似，至此一个简单的单表CRUD程序已经能run起来了。</p>

  </article>

</div>

        </section>
    </div>

    <!--<footer class="site-footer">-->

  <!--<div class="wrapper">-->

    <!--<h2 class="footer-heading">Qiuliang's Blog</h2>-->

    <!--<div class="footer-col-wrapper">-->
      <!--<div class="footer-col  footer-col-1">-->
        <!--<ul class="contact-list">-->
          <!--<li>Qiuliang's Blog</li>-->
          <!--<li><a href="mailto:your-email@domain.com">your-email@domain.com</a></li>-->
        <!--</ul>-->
      <!--</div>-->

      <!--<div class="footer-col  footer-col-2">-->
        <!--<ul class="social-media-list">-->
          <!---->
          <!--<li>-->
            <!--<a href="https://github.com/jekyll">-->
              <!--<span class="icon  icon--github">-->
                <!--<svg viewBox="0 0 16 16">-->
                  <!--<path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>-->
                <!--</svg>-->
              <!--</span>-->

              <!--<span class="username">jekyll</span>-->
            <!--</a>-->
          <!--</li>-->
          <!---->

          <!---->
          <!--<li>-->
            <!--<a href="https://twitter.com/jekyllrb">-->
              <!--<span class="icon  icon--twitter">-->
                <!--<svg viewBox="0 0 16 16">-->
                  <!--<path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809-->
                  <!--c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>-->
                <!--</svg>-->
              <!--</span>-->

              <!--<span class="username">jekyllrb</span>-->
            <!--</a>-->
          <!--</li>-->
          <!---->
        <!--</ul>-->
      <!--</div>-->

      <!--<div class="footer-col  footer-col-3">-->
        <!--<p class="text">Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</p>-->
      <!--</div>-->
    <!--</div>-->

  <!--</div>-->

<!--</footer>-->

<footer>
    <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
</footer>

  </body>

</html>
